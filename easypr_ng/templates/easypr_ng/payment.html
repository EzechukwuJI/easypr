{% extends 'easypr_general/base.html' %}
{% load staticfiles %}

{% block title %}payment section{% endblock title %}
{% block inner_content %}
	<section id="main-container" class="main-container">
		<form action="" method="post">
		{% csrf_token %}
		<div class="container">
			<div class="row">
				<!-- <h3>Payment</h3> -->
				<!-- <hr style="margin:0px;" /> -->
				<div class="col-md-9" style="color:#000000;">

					<div class="well well-default no-border-radius">
						<h4>Summary </h4>
						<hr style="margin-top:5px;" />
						<div class="row">
							<div class="col-md-6 bg-danger">
							</div>
							<div class="col-md-6 bg-danger" style="background-color:lightblue; padding:15px; border-radius:5px;">
								<!-- <div><strong>Press Material</strong> <span class="pull-right">{{ post.press_material }}</span></div> -->
								<div><strong>Bouquet:</strong><span class="pull-right">{{ purchase.bouquet }}</span></div>

								<div><strong>Number of Media:</strong><span class="pull-right">{{ purchase.bouquet.num_of_media }}</span></div>
								<div><strong>Price per Medium:</strong><span class="pull-right"> $ {{ purchase.bouquet.price_per_media_N }}</span></div>
								<div><strong>VAT:</strong><span class="pull-right"> ${{ purchase.bouquet.price_per_media_N }}</span></div>
								<div><strong>Percentage Savings:</strong><span class="pull-right">$ {{ purchase.bouquet.percentage_savings }}</span></div>
								<hr style="margin-bottom: 10px;"/>
								<div><strong>Total Amount Payable: </strong><span class="pull-right">$ {{ purchase.bouquet.amount_payable_N }}</span> </div>
							</div>
						</div>
					</div>

					<div class="well well-default no-border-radius bg-white">
						<h4>Select Payment Option </h4>
						<hr style="margin:2px;" />
						<div class="row">
							<div class="col-md-6">
								<div class="payment-box" id="debit_card" onclick='return select_payment("debit_card");'>
									<img class="thumbnail" src="{% static 'easypr/images/payment/visa.png' %}" alt="Easypr Nigeria" />
									<img class="thumbnail" src="{% static 'easypr/images/payment/verve.png' %}" alt="Easypr Nigeria" />
									<img class="thumbnail" src="{% static 'easypr/images/payment/mastercard.png' %}" alt="Easypr Nigeria" />
									<input type="checkbox" class="hidden" name="payment-type" id="check_debit_card"/>
									<div class="text-center pull-right">
										<h4>Pay with debit card</h4>

									</div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="payment-box" id = "bank_deposit" onclick='return select_payment("bank_deposit");'>
									<!-- <img class="thumbnail" src="{% static 'easypr/images/payment/visa.png' %}" alt="Easypr Nigeria" /> -->
									<input type="checkbox" class="hidden" name="payment-type" id="check_bank_deposit" />
									<div class="text-center">
										<h4>Pay directly into our bank account</h4>
										<strong class="text-danger text-center">(For clients in Nigeria Only)</strong><br/>
										<small class="text-dark text-center">Enter details in the form provided below</small>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-6">
								<div class="payment-box" id = "bank_transfer" onclick='return select_payment("bank_transfer");'>
									<input type="checkbox" class="hidden" name="payment-type" id="check_bank_transfer"/>
									<div class="text-center">
										<h4>Pay with bank transfer</h4>
										<small class="text-dark text-center">Enter details in the form provided below</small>
									</div>
								</div>
							</div>
							<div class="col-md-6">
							</div>
						</div>
					</div>
				</form>

				<form id = "paydetails_form">
					<span id="id_saved_status"></span>
					{% csrf_token %}
						<div class="row hidden" id="pay-details">
							<div class="col-md-6" style="background-color: lightblue;">
								<h5> Enter Payment Details </h5><hr style="margin-top:20px;"/>
								<input type="hidden" name="payment_method" id="id_payment_method" />
								<div class="row">
									<div class="col-md-4">
										<strong>Teller Number: </strong>
									</div>							
									<div class="col-md-8">
										<input class="form-control no-border-radius bg-white" type="text" name="teller_number" id="id_teller_number" />
									</div>
								</div>
								<br/>
								<div class="row">
									<div class="col-md-4">
										<strong>Bank: </strong>
									</div>							
									<div class="col-md-8">
										<select class="form-control no-border-radius bg-white" name="bankname" id="id_bankname">
											<option value="Diamond Bank">Diamond Bank</option>
											<option value="GTB">Guarantee Trust Bank</option>
										</select>
									</div>
								</div>
								<br/>
								<div class="row">
									<div class="col-md-4">
										<strong>Amount Paid: </strong>
									</div>							
									<div class="col-md-8">
										<input class="form-control no-border-radius bg-white" type="number" name="amount" id="id_amount"/>
									</div>
								</div>
								<br/>
								<div class="row">
									<div class="col-md-4">
										<strong>Date Paid: </strong>
									</div>							
									<div class="col-md-8">
										<input class="form-control no-border-radius bg-white" type="date" name="date_paid" id="id_date_paid" />
									</div>
								</div>
								<br/>
								<div class="row">
									<div class="col-md-4">
										<!-- <strong>Date Paid: </strong> -->
									</div>							
									<div class="col-md-8">
										<a class="btn btn-success pull-right" id="id_save_payment" onclick='return save_pay_details()' >Save Payment</a>
										
									</div>
								</div>
								<br/>
							</div>
						</div>
						<br/>
						{% if purchase.ordered %}
						<div>
							<input type="checkbox" name="accept_t_n_c" value="{{ purchase.ordered }}" checked= "{{ purchase.ordered }}" id="id_tandc" disabled />
							<strong>&nbsp; &nbsp; Accept  <a href="{% url 'general:terms-and-conditions' %}"> Terms and Conditions </a> for content submission and distribution</strong>
						</div>

					  {% else %}
					  	<div class = "hidden" id="tandc_div">
							<input type="checkbox" name="accept_t_n_c" value="false" id="id_tandc" onclick='return  accept_TandC()' />
							<strong> &nbsp; &nbsp; Accept <a href="{% url 'general:terms-and-conditions' %}"> Terms and Conditions </a> for content submission and distribution</strong>
						</div>
					  {% endif %}
					</form>
					<hr/>
					<div class="row no-border-radius bg-white">
						<a href="{% url 'easypr_ng:payment' post.transaction_id %}" class="btn btn-primary pull-right" id="id_proceed" {% if not purchase.ordered %} disabled {% endif %}> Proceed </a>
						<!-- <a href="{% url 'easypr_ng:confirmation' %}" class="btn btn-primary pull-right" id="id_proceed" {% if not purchase.ordered %} disabled {% endif %}> Proceed </a> -->
						<a href="" class="btn btn-primary pull-left"> Back </a>
					</div>
				</div>
				<div class="col-md-3">
				</div>
			</div><!-- Content row -->
		</div><!-- Conatiner end -->
	
</section><!-- Main container end -->
	
{% endblock inner_content %}




{% block inline_scripts %}
<script>
	function save_pay_details() {
		var form = $('#paydetails_form');
		var payment_method  =   $('#id_payment_method').val();
		var teller_number 	=   $('#id_teller_number').val();
		var amount_paid 	=   $('#id_amount').val();
		var bankname 		= 	$('#id_bankname').find(':selected').attr('value');
		var date_paid 		=   $('#id_date_paid').val();
		var csrf_token      =   $('input[name="csrfmiddlewaretoken"]').val();
		function csrfSafeMethod(method){
			// these HTTP methods do not require CSRF protection
			return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		}
		$.ajaxSetup({
			beforeSend: function(xhr, settings){
				if (!csrfSafeMethod(settings.type) && !this.crossDomain){
					xhr.setRequestHeader("X-CSRFToken", csrf_token);
				}
			}
		});
		$.ajax({
			url: "{% url 'easypr_ng:save-pay-details' purchase.transaction_id %}",
			type: "POST",
			data: {method:payment_method, teller:teller_number,amount:amount_paid,date:date_paid,bank:bankname, csrfmiddlewaretoken: csrf_token},
			success: function(data){
				$("#id_saved_status").html("<strong class='text-success'> Payment details saved!</strong>");
				$('#pay-details').addClass('hidden');
				$("#tandc_div").removeClass('hidden');
				// if ($("#id_tandc").is(':checked')){
				// 	$('#id_proceed').removeAttr('disabled');
				// }
			},
			error: function(data){
				$("#id_saved_status").html("<strong class='text-danger'> Oops! something went wrong, please try again.</strong>");	
			}
		})
	}


	function accept_TandC(){
		var $this = $("#id_tandc");
		$this.is(':checked') ? $('#id_proceed').removeAttr('disabled') : $('#id_proceed').attr('disabled',true);
	}
</script>


{% endblock inline_scripts %}







